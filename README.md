# Whispin

åŒ¿åãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ - Flutterè£½ã®ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚¢ãƒ—ãƒª

## ğŸ“± æ¦‚è¦

Whispinã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒ¿åã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆã‚’æ¥½ã—ã‚ã‚‹Flutterã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã—ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æ™‚é–“åˆ¶é™ä»˜ãã®ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- **åŒ¿åãƒãƒ£ãƒƒãƒˆ**: ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ãŸåŒ¿åãƒãƒ£ãƒƒãƒˆ
- **ãƒ«ãƒ¼ãƒ ãƒ™ãƒ¼ã‚¹**: ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã®ä½œæˆãƒ»å‚åŠ 
- **æ™‚é–“åˆ¶é™**: 10åˆ†é–“ã®åˆ¶é™æ™‚é–“ä»˜ããƒãƒ£ãƒƒãƒˆï¼ˆå»¶é•·å¯èƒ½ï¼‰
- **è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ **: ãƒãƒ£ãƒƒãƒˆå¾Œã®ç›¸æ‰‹è©•ä¾¡
- **ãƒ•ãƒ¬ãƒ³ãƒ‰æ©Ÿèƒ½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹ãƒ»ç®¡ç†
- **ãƒ–ãƒ­ãƒƒã‚¯æ©Ÿèƒ½**: ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ­ãƒƒã‚¯
- **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³**: å»¶é•·å›æ•°ç„¡åˆ¶é™ãªã©ã®ç‰¹å…¸
- **ç®¡ç†è€…æ©Ÿèƒ½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ãƒ­ã‚°é–²è¦§ã€ãŠå•ã„åˆã‚ã›å¯¾å¿œ

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
lib/
â”œâ”€â”€ config/                 # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
â”‚   â”œâ”€â”€ app_config.dart
â”‚   â”œâ”€â”€ environment.dart
â”‚   â””â”€â”€ firebase_config.dart
â”œâ”€â”€ constants/             # å®šæ•°å®šç¾©
â”‚   â”œâ”€â”€ app_constants.dart
â”‚   â”œâ”€â”€ colors.dart
â”‚   â”œâ”€â”€ routes.dart
â”‚   â””â”€â”€ text_styles.dart
â”œâ”€â”€ extensions/            # æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰
â”‚   â”œâ”€â”€ context_extensions.dart
â”‚   â”œâ”€â”€ datetime_extensions.dart
â”‚   â”œâ”€â”€ list_extensions.dart
â”‚   â”œâ”€â”€ num_extensions.dart
â”‚   â””â”€â”€ string_extensions.dart
â”œâ”€â”€ models/               # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ user.dart
â”‚   â”œâ”€â”€ chat_room.dart
â”‚   â”œâ”€â”€ friendship.dart
â”‚   â”œâ”€â”€ friend_request.dart
â”‚   â”œâ”€â”€ invitation.dart
â”‚   â”œâ”€â”€ block.dart
â”‚   â””â”€â”€ ...
â”œâ”€â”€ repositories/         # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚   â”œâ”€â”€ base_repository.dart
â”‚   â”œâ”€â”€ user_repository.dart
â”‚   â”œâ”€â”€ chat_room_repository.dart
â”‚   â”œâ”€â”€ friendship_repository.dart
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/            # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”œâ”€â”€ auth_service.dart
â”‚   â”œâ”€â”€ chat_service.dart
â”‚   â”œâ”€â”€ storage_service.dart
â”‚   â”œâ”€â”€ invitation_service.dart
â”‚   â””â”€â”€ ...
â”œâ”€â”€ providers/           # çŠ¶æ…‹ç®¡ç†
â”‚   â”œâ”€â”€ user_provider.dart
â”‚   â”œâ”€â”€ admin_provider.dart
â”‚   â””â”€â”€ chat_provider.dart
â”œâ”€â”€ screens/             # UIç”»é¢
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ home_screen.dart
â”‚   â”‚   â”œâ”€â”€ profile.dart
â”‚   â”‚   â”œâ”€â”€ chat_screen.dart
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ admin/
â”‚       â”œâ”€â”€ admin_home_screen.dart
â”‚       â””â”€â”€ ...
â”œâ”€â”€ widgets/             # å†åˆ©ç”¨å¯èƒ½ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â””â”€â”€ header.dart
â”‚   â””â”€â”€ ...
â”œâ”€â”€ routes/              # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”œâ”€â”€ app_router.dart
â”‚   â”œâ”€â”€ navigation_helper.dart
â”‚   â””â”€â”€ routes_guard.dart
â”œâ”€â”€ utils/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ app_logger.dart
â”‚   â””â”€â”€ navigation_logger.dart
â””â”€â”€ main.dart           # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

**Repository Pattern + Provider**

- **Repositoryå±¤**: Firestoreã¨ã®é€šä¿¡ã‚’æŠ½è±¡åŒ–
- **Serviceå±¤**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’é›†ç´„
- **Provider**: çŠ¶æ…‹ç®¡ç†ã¨UIã¸ã®é€šçŸ¥
- **Extensions**: Dartæ¨™æº–å‹ã®æ©Ÿèƒ½æ‹¡å¼µ

---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å¿…è¦è¦ä»¶

- Flutter SDK 3.0ä»¥ä¸Š
- Dart 3.0ä»¥ä¸Š
- Firebase CLI
- Node.jsï¼ˆFirebaseã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ç”¨ï¼‰

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

1. **ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³**
```bash
git clone https://github.com/your-repo/whispin.git
cd whispin
```

2. **ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
flutter pub get
```

3. **Firebaseè¨­å®š**
```bash
# Firebase CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g firebase-tools

# Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–
firebase init
```

4. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**

`lib/config/environment.dart`ã‚’ç·¨é›†ã—ã€Firebaseè¨­å®šã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚
```dart
static const String firebaseApiKey = 'YOUR_API_KEY';
static const String firebaseProjectId = 'YOUR_PROJECT_ID';
// ...
```

5. **Firebaseã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®èµ·å‹•**ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
```bash
firebase emulators:start
```

6. **ã‚¢ãƒ—ãƒªã®èµ·å‹•**
```bash
flutter run
```

---

## ğŸ”¥ Firebaseæ§‹æˆ

### ä½¿ç”¨ã‚µãƒ¼ãƒ“ã‚¹

- **Firebase Authentication**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
- **Cloud Firestore**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **Firebase Emulator**: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

### Firestoreã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ 
```
User/
  - id (Email)
  - firstName, lastName, nickname
  - premium (boolean)
  - rate (double)
  - roomCount (int)
  - createdAt, deletedAt

rooms/
  - id (roomId)
  - topic (string)
  - status (0: å¾…æ©Ÿ, 1: ä¼šè©±ä¸­, 2: çµ‚äº†)
  - id1, id2 (å‚åŠ è€…)
  - startedAt, expiresAt
  - extensionCount

friendships/
  - id
  - userId, friendId
  - active (boolean)

friendRequests/
  - id
  - senderId, receiverId
  - status (pending/accepted/rejected)

blocks/
  - id
  - blockerId, blockedId
  - active (boolean)

invitations/
  - id
  - roomId
  - inviterId, inviteeId
  - status
  - expiresAt

administrator/
  - email
  - password
  - lastLogin

Log_Premium/
  - ID (é›»è©±ç•ªå· or Email)
  - Timestamp
  - Detail (å¥‘ç´„/è§£ç´„)
```

---

## ğŸ“¦ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```yaml
dependencies:
  flutter:
    sdk: flutter
  #UI/UX
  google_fonts: 6.3.2

  # Firebase ç³»ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆäº’æ›æ€§ã‚’è€ƒæ…®ï¼‰
  firebase_core: 4.2.1
  firebase_auth: 6.1.2
  cloud_firestore: 6.1.0

  #Utilities
  http: 1.6.0
  crypto: 3.0.3
  shared_preferences: 2.2.2
  intl: 0.19.0
  path_provider: 2.1.5

  # Other
  image_picker: 1.2.1
  provider: 6.1.2

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: 6.0.0
```

---

## ğŸ¯ ä¸»è¦æ©Ÿèƒ½ã®å®Ÿè£…è©³ç´°

### 1. èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

**Firebase Authentication + Firestoreé€£æº**
```dart
// services/user_auth_service.dart
Future<User?> loginUser({
  required String email,
  required String password,
}) async {
  final credential = await _auth.signInWithEmailAndPassword(
    email: email.trim(),
    password: password.trim(),
  );
  
  // Firestoreã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
  final query = await _firestore
      .collection("User")
      .where("email", isEqualTo: email)
      .limit(1)
      .get();
  
  return credential.user;
}
```

### 2. ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ç®¡ç†

**Repository Patternæ¡ç”¨**
```dart
// repositories/chat_room_repository.dart
Future<List<ChatRoom>> findWaitingRooms() async {
  return findByStatus(AppConstants.roomStatusWaiting);
}

Future<void> joinRoom(String roomId, String userId) async {
  final room = await findById(roomId);
  // ãƒ«ãƒ¼ãƒ å‚åŠ ãƒ­ã‚¸ãƒƒã‚¯
  await updateFields(roomId, {
    'id2': userId,
    'status': AppConstants.roomStatusActive,
    'startedAt': now.toIso8601String(),
  });
}
```

### 3. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

**Streamã¨Timerã®ä½µç”¨**
```dart
// services/chat_service.dart
void startRoomTimer(String roomId, DateTime expiresAt) {
  final duration = expiresAt.difference(DateTime.now());
  
  _roomTimers[roomId] = Timer(duration, () async {
    await deleteRoom(roomId);
  });
}
```

### 4. ãƒ­ã‚®ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

**çµ±ä¸€ãƒ­ã‚¬ãƒ¼å®Ÿè£…**
```dart
// utils/app_logger.dart
logger.section('å‡¦ç†é–‹å§‹', name: 'ServiceName');
logger.info('æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', name: 'ServiceName');
logger.success('æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸', name: 'ServiceName');
logger.error('ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: $e', name: 'ServiceName', error: e);
```

---

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–**: PBKDF2ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚·ãƒ¥åŒ–
2. **è«–ç†å‰Šé™¤**: ç‰©ç†å‰Šé™¤ã§ã¯ãªãè«–ç†å‰Šé™¤ã‚’æ¡ç”¨
3. **ãƒ–ãƒ­ãƒƒã‚¯æ©Ÿèƒ½**: ä¸é©åˆ‡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ­ãƒƒã‚¯
4. **ç®¡ç†è€…èªè¨¼**: Firestoreç®¡ç†è€…ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§ã®æ¨©é™ç¢ºèª

### Firebase Securityãƒ«ãƒ¼ãƒ«ä¾‹
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /User/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == userId;
    }
    
    match /rooms/{roomId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null && 
        (resource.data.id1 == request.auth.uid || 
         resource.data.id2 == request.auth.uid);
    }
  }
}
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# å˜ä½“ãƒ†ã‚¹ãƒˆ
flutter test

# çµ±åˆãƒ†ã‚¹ãƒˆ
flutter test integration_test/
```

---

## ğŸ“± ãƒ“ãƒ«ãƒ‰

### Android
```bash
flutter build apk --release
```

### iOS
```bash
flutter build ios --release
```

### Web
```bash
flutter build web --release
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

**Q: Firebaseã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã«æ¥ç¶šã§ããªã„**
```bash
# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
firebase emulators:start

# ãƒãƒ¼ãƒˆãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
lsof -i :8080
lsof -i :9099
```

**Q: ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œãªã„**
```dart
// UserProvider.loadUserData()ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
final userProvider = context.read<UserProvider>();
await userProvider.loadUserData(email);
```

**Q: ãƒ«ãƒ¼ãƒ ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ä½œã—ãªã„**
```dart
// ChatService.startRoomTimer()ãŒæ­£ã—ãå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
chatService.startRoomTimer(roomId, expiresAt);
```

---

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼

1. ãƒ•ã‚©ãƒ¼ã‚¯
2. æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒä½œæˆ (`git checkout -b feature/amazing-feature`)
3. ã‚³ãƒŸãƒƒãƒˆ (`git commit -m 'Add amazing feature'`)
4. ãƒ—ãƒƒã‚·ãƒ¥ (`git push origin feature/amazing-feature`)
5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ

---

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## ğŸ‘¥ ä½œæˆè€…

- **é–‹ç™ºãƒãƒ¼ãƒ **: Whispin Development Team
- **ãŠå•ã„åˆã‚ã›**: support@whispin.app

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [Flutterå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://flutter.dev/docs)
- [Firebaseå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs)
- [Provider ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸](https://pub.dev/packages/provider)

---

## ğŸ—ºï¸ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

- [ ] ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥æ©Ÿèƒ½
- [ ] ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰
- [ ] ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½
- [ ] AIè‡ªå‹•ç¿»è¨³
- [ ] ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
- [ ] Webç‰ˆã®æœ€é©åŒ–

---

## ğŸ“Š çµ±è¨ˆæƒ…å ±

- **ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ~20,000è¡Œ
- **ãƒ¢ãƒ‡ãƒ«æ•°**: 15å€‹
- **Repositoryæ•°**: 6å€‹
- **ã‚µãƒ¼ãƒ“ã‚¹æ•°**: 10å€‹
- **ç”»é¢æ•°**: 20ç”»é¢ä»¥ä¸Š

---

**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ9æ—¥